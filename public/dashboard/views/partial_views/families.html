<!--<script type="text/javascript">
  function fill (){
    $.get('/api/user/' + document.getElementById('iddi').innerHTML)
      .success(function(data){

        data.payload.roles.forEach(function(entry) {
            if (data.payload.roles.indexOf("Admin") > -1) {
                var e = document.getElementById('title');
                e.visibility = "visible";

                e = document.getElementById('main');
                e.visibility = "visible";
            } 
            ;        
        });
        

      });
  };
</script>

<h1 hidden id="iddi">{{global.user._id}}</h1>

<div hidden id="title" class="row">-->
<!--<div class="row" ng-show="user.isAdmin()">-->
<div class="row">

  <h1 class="section-header">Families</h1>  

  <hr>
</div>

<!--<div hidden id="main" ng-controller="FamilyCtrl" ng-show="user.isAdmin()">-->
<div id="main" ng-controller="FamilyCtrl">
      
      <div class="row bot10" id="operation">
        <div class="col-md-6">
          <div class="input-group col-md-8">
            <input type="search" class="search-query form-control" placeholder="Type here"
              ng-model="searchFamily" />
            <span class="input-group-btn">
              <button class="btn btn-danger" type="button">
                <span class="glyphicon glyphicon-search"></span>
              </button>
            </span>
          </div>
        </div>

        <div class="controls col-md-4 pull-right">
          <button type="button" class="btn btn-success btn-sm" 
                  data-toggle="collapse" data-parent="#operation" href="#formInsert">
            <span class="glyphicon glyphicon-plus"></span> Add new
          </button>

          <button id="btn_edit" type="button" class="btn btn-primary btn-sm" ng-click="showEditFamily = !showEditFamily" ng-disabled="showEditFamily">
            <span class="glyphicon glyphicon-pencil" ></span> Edit
          </button>
          <button id="btn_finish" type="button" class="btn btn-primary btn-sm" ng-click="finishedOperation()"
                  ng-disabled="!showEditFamily">
            <span class="glyphicon glyphicon-pencil"></span> Finish
          </button>
        </div>
      </div>

      <!-- appearance panel -->
      <div id="formInsert" class="top10 bot10 panel-collapse collapse out row col-md-6 col-md-offset-3 text-center panel panel-primary appearance">

        <h4>Create family</h3>

        <div class="panel-body">
          <form class="form-horizontal">
            <fieldset>

              <!-- Text input-->
              <div class="control-group">
                <label class="control-label" for="nameFamily">Name</label>
                <div class="controls">
                  <input id="nameFamily" name="nameFamily" type="text" placeholder="" class="form-control input-xlarge" ng-model="family.name">
                </div>
              </div>

              <!-- Button (Double) -->
              <div class="control-group top10">
                <div class="controls">
                  <button id="save_btn" name="save_btn" class="btn btn-success" ng-click="createFamily(family)">Save</button>
                  <button id="cancel_btn" name="cancel_btn" class="btn btn-danger" ng-click="cancel()">Cancel</button>
                </div>
              </div>

            </fieldset>
          </form>
        </div>
      </div>

      <div id="patientsPanel" class="top10 bot10 panel-collapse collapse out row appearance">
        <div class="panel panel-primary col-md-6">
          <h4>Patients out family</h3>

         <ul class="list-group">
            <li class="list-group-item" ng-repeat="patient in outPatients">
              <div class="row">
                  <div class="pull-left">{{ patient.name }}</div>
                  <div class="pull-right">  
                    <button type="button" class="btn btn-success btn-sm" ng-click="addPatient(patient)">
                            <span class="glyphicon glyphicon-plus"></span>
                    </button>
                  </div>
              </div>
            </li>
          </ul>

        </div>

        <div class="panel panel-primary col-md-6">
          <h4>Patients in family</h3>

          <ul class="list-group" >
              <li class="list-group-item" ng-repeat="patient in inPatients">
                <div class="row">
                  <div class="pull-left">{{ patient.name }}</div>
                  <div class="pull-right">  
                    <button type="button" class="btn btn-danger btn-sm" ng-click="removePatient(patient)">
                            <span class="glyphicon glyphicon-trash"></span>
                    </button>
                  </div>
                </div>
              </li>
          
          </ul>
        </div>
      </div>

      <div id="showPanel" class="top10 bot10 panel-collapse collapse out row appearance">
        <div class="panel panel-primary col-md-6 col-md-offset-3">
          <h4>Patients in family</h3>
            <table class="table table-bordered col-md-6 col-md-offset-3">
              <thead>
                <tr> 
                  <th>Name</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="patient in inPatients">
                  <td>{{ patient.name }}</td>
                </tr>
              </tbody>
            </table>
        </div>
      </div>

      <!-- -->
      
      <div class="row">
          <div>
            <table class="table table-bordered" ng-show="!showEditFamily">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Members</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="family in families | filter:searchFamily "> 
                    <td>{{ family.name }}</td>
                    <td id="parents">
                      <button type="button" class="btn btn-default btn-sm col-md-3 col-md-offset-4" 
                              ng-click="showPatients(family)" 
                              data-toggle="collapse" data-parent="#parents" href="#showPanel">
                              <span class="glyphicon glyphicon-user"></span> Show Patients
                      </button>
                    </td>                  
                </tr>
                <tr>
                </tr>
              </tbody>
            </table>

            <table class="table table-bordered" ng-show="showEditFamily">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Operation</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="family in families | filter:searchFamily "> 
                    <td>
                      <div ng-show="!showConfirm">{{ family.name }}</div>
                      <input id="nameUpdate" name="nameUpdate" type="text" value="{{ family.name }}" class="form-control input-xlarge" ng-model="familyUpdate.name" ng-show="showConfirm">
                    </td>
                    <td>
                      <div class="control-group pull-right" ng-show="!showConfirm">
                        <div class="controls" id="controlsBtn">
                          <button type="button" class="btn btn-success btn-sm" ng-click="showConfirm = !showConfirm">
                            <span class="glyphicon glyphicon-pencil"></span> Edit Name
                          </button>
                          <button type="button" class="btn btn-primary btn-sm" 
                                  data-toggle="collapse" data-parent="#controlsBtn" href="#patientsPanel"
                                  ng-click="showPatients(family)">
                            <span class="glyphicon glyphicon-pencil"></span> Edit Patients
                          </button>
                          <button type="button" class="btn btn-danger btn-sm" ng-click="removeFamily(family)">
                            <span class="glyphicon glyphicon-trash"></span> Remove
                          </button>
                        </div>
                      </div>

                      <div class="control-group pull-right" ng-show="showConfirm">
                        <div class="controls">
                          <button type="button" class="btn btn-success btn-sm" ng-click="updateFamily(family, familyUpdate)">
                            <span class="glyphicon glyphicon-pencil"></span> OK
                          </button>
                          <button type="button" class="btn btn-danger btn-sm" ng-click="showConfirm = false">
                            <span class="glyphicon glyphicon-ban-circle" ></span> Cancel
                          </button>
                        </div>
                      </div>
                    </td>
                </tr>
                <tr>
                </tr>
              </tbody>
            </table>
          </div>
      </div>

</div>
 
</div>

</div>